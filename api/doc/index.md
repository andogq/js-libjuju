<!---
NOTE: this file has been generated by the doc command in js-libjuju
on Fri 2018/11/09 14:32:39 UTC. Do not manually edit this file.
--->
# Juju API client

This project provides a JavaScript API client for interacting with the Juju
WebSocket API.

- [Getting Started](#getting-started)
- [API Reference](#api-reference)
  - [connect](#connect)
  - [connectAndLogin](#connectAndLogin)
  - [Client](#Client)
  - [Connection](#Connection)
  - [Transport](#Transport)
- [Facades Reference](#facades-reference)
- [Facade Helpers](#facade-helpers)
- [Examples](#examples)

## Getting Started

In order to access the Juju API, a connection must be made, to either a Juju
controller or model, for instance:
```javascript
const facades = [
  require('jujulib/api/facades/all-watcher-v1'),
  require('jujulib/api/facades/application-v5'),
  require('jujulib/api/facades/client-v1'),
  require('jujulib/api/facades/client-v2'),
  require('jujulib/api/facades/pinger-v1')
];
jujulib.connect('wss://example.com/model/x-y-z/api', {facades: facades}, (err, juju) => {
  // Login here.
});
```
In the code above, a connection is being established to the provided model API
URL, and the client declares to be interested in using the specified set of
facades. When multiple versions of the same facade are included (like the two
client versions in the example), the most recent version supported by the
server is made available to the client.

The provided callback receives an error and a *juju* object that can be used to
log into the controller or model, by providing userpass credentials or
macaroons. When macaroons are used for logging in, a bakery instance must also
be provided as part of the options. See
<https://www.npmjs.com/package/macaroon-bakery>.

It is possible to connect and log into Juju in one single call by using
`jujulib.connectAndLogin`, for instance:
```javascript
jujulib.connectAndLogin(url, credentials, options, (err, result) => {
  // Check error here or use result.conn.
});
```
In this specific case possible redirect errors are automatically handled. The
provided callback receives a result which includes the connection itself
(from which is possible to access facade methods) and a close function used to
log out and close the connection.

All API methods and facade methods return a *Promise* if a callback is not
provided. The above can be written in a more imperative fashion by using await:
```javascript
try {
  const {conn, close} = await jujulib.connectAndLogin(url, credentials, options);
} catch err {
  // Handle error.
}
```

Here is an example of actually using the client facade to send a request.
More examples can be found in the [examples](#examples) section.
```javascript
const options = {
  facades: [require('jujulib/api/facades/client-v1.js')],
  bakery: new bakery.Bakery({
    visitPage: resp => {
      console.log('visit this URL to login:', resp.Info.VisitURL);
    }
  })
};

const {conn, close} = await jujulib.connectAndLogin(url, credentials, options);
const client = conn.facades.client;
const result = await client.addMachine({series: 'bionic'});
console.log('machine added:', result.machine);
```

## API Reference

### connect

Connect to the Juju controller or model at the given URL.

#### Parameters

-   `url` **[String][1]** The WebSocket URL of the Juju controller or model.
-   `options` **[Object][2]** Connections options, including:-   facades (default=\[]): the list of facade classes to include in the API
        connection object. Those classes are usually auto-generated and can be
        found in the facades directory of the project. When multiple versions of
        the same facade are included, the most recent version supported by the
        server is made available as part of the connection object;
    -   debug (default=false): when enabled, all API messages are logged at debug
        level;
    -   wsclass (default=W3C browser native WebSocket): the WebSocket class to
        use for opening the connection and sending/receiving messages. Server
        side, require('websocket').w3cwebsocket can be used safely, as it
        implements the W3C browser native WebSocket API;
    -   bakery (default: null): the bakery client to use when macaroon discharges
        are required, in the case an external user is used to connect to Juju;
        see [https://www.npmjs.com/package/macaroon-bakery][3];
    -   closeCallback: a callback to be called with the exit code when the
        connection is closed. (optional, default `{}`)
-   `callback` **[Function][4]** Called when the connection is made, the
    callback receives an error and a client object. If there are no errors, the
    client can be used to login and logout to Juju. See the docstring for the
    Client class for information on how to use the client. (optional, default `null`)

Returns **[Promise][5]** This promise will be rejected if there is an error
connecting, or resolved with a new Client instance. Note that the promise
will not be resolved or rejected if a callback is provided.

---
### connectAndLogin

Connect to the Juju controller or model at the given URL and the authenticate
using the given credentials.

#### Parameters

-   `url` **[String][1]** The WebSocket URL of the Juju controller or model.
-   `credentials` **[Object][2]** An object with the user and password fields for
    userpass authentication or the macaroons field for bakery authentication.
    If an empty object is provided a full bakery discharge will be attempted
    for logging in with macaroons. Any necessary third party discharges are
    performed using the bakery instance provided in the options (see below).
-   `options` **[Object][2]** Connections options, including:-   facades (default=\[]): the list of facade classes to include in the API
        connection object. Those classes are usually auto-generated and can be
        found in the facades directory of the project. When multiple versions of
        the same facade are included, the most recent version supported by the
        server is made available as part of the connection object;
    -   debug (default=false): when enabled, all API messages are logged at debug
        level;
    -   wsclass (default=W3C browser native WebSocket): the WebSocket class to
        use for opening the connection and sending/receiving messages. Server
        side, require('websocket').w3cwebsocket can be used safely, as it
        implements the W3C browser native WebSocket API;
    -   bakery (default: null): the bakery client to use when macaroon discharges
        are required, in the case an external user is used to connect to Juju;
        see [https://www.npmjs.com/package/macaroon-bakery][3];
    -   closeCallback: a callback to be called with the exit code when the
        connection is closed.
-   `callback` **[Function][4]** Called when the login process completes, the
    callback receives an error, or a {conn, logout} result including a
    connection object and a logout function that can be used to close the
    connection. If there are no errors, the connection can be used to
    send/receive messages to and from the Juju controller or model, and to get
    access to the available facades (through conn.facades). See the docstring
    for the Connection class for information on how to use the connection
    instance. Redirection errors are automatically handled by this function, so
    any error is a real connection problem.

Returns **[Promise][5]** This promise will be rejected if there is an error
connecting, or resolved with a new {conn, logout} object. Note that the
promise will not be resolved or rejected if a callback is provided.

---
### Client

A Juju API client allowing for logging in and get access to facades.

#### Parameters

-   `ws` **[Object][2]** The WebSocket instance already connected to a Juju
    controller or model.
-   `options` **[Object][2]** Connections options. See the connect documentation
    above for a description of available options.

#### login

Log in to Juju.

#### Parameters

-   `credentials` **[Object][2]** An object with the user and password fields for
    userpass authentication or the macaroons field for bakery authentication.
    If an empty object is provided a full bakery discharge will be attempted
    for logging in with macaroons. Any necessary third party discharges are
    performed using the bakery instance originally provided to connect().
-   `callback` **[Function][4]** Called when the login process completes,
    the callback receives an error and a connection object. If there are no
    errors, the connection can be used to send/receive messages to and from
    the Juju controller or model, and to get access to the available facades
    (through conn.facades). See the docstring for the Connection class for
    information on how to use the connection instance. If an error is
    returned, clients can check whether it's a redirection error as done by
    JAAS when a new connection to the actual remote model is required. You
    can check if that's the case using client.isRedirectionError(err). If it
    is a redirection error, information about available servers is stored in
    err.servers and err.caCert (if a certificate is required). (optional, default `null`)

Returns **[Promise][5]** This promise will be rejected if there is an error
connecting, or resolved with a new connection instance. Note that the
promise will not be resolved or rejected if a callback is provided.

#### logout

Log out from Juju.

#### Parameters

-   `callback` **[Function][4]** Called when the logout process completes and the
    connection is closed, the callback receives the close code and optionally
    another callback. It is responsibility of the callback to call the
    provided callback if present.

#### isRedirectionError

Report whether the given error is a redirection error from Juju.

#### Parameters

-   `err` **Any** The error returned by the login request.

Returns **[Boolean][6]** Whether the given error is a redirection error.

---
### Transport

A transport providing the ability of sending and receiving WebSocket messages
to and from Juju controllers and models.

#### Parameters

-   `ws` **[Object][2]** The WebSocket instance already connected to a Juju
    controller or model.
-   `closeCallback` **[Function][4]** A callback to be called after the transport
    closes the connection. The callback receives the close code.
-   `debug` **[Boolean][6]** When enabled, all API messages are logged at debug
    level.

#### write

Send a message to Juju.

#### Parameters

-   `req` **[Object][2]** A Juju API request, typically in the form of an object
    like {type: 'Client', request: 'DoSomething', version: 1, params: {}}.
    The request must not be already serialized and must not include the
    request id, as those are responsibilities of the transport.
-   `callback` **[Function][4]** Called when the response to the given request is
    ready, the callback receives an error and the response result from Juju.

#### close

Close the transport, and therefore the connection.

#### Parameters

-   `callback` **[Function][4]** Called after the transport is closed, the
    callback receives the close code and optionally another callback. It is
    responsibility of the callback to call the provided callback if present.

#### \_handle

Handle responses arriving from Juju.

#### Parameters

-   `data` **[String][1]** : the raw response from Juju, usually as a JSON encoded
    string.

---
### Connection

A connection to a Juju controller or model. This is the object users use to
perform Juju API calls, as it provides access to all available facades
(conn.facades), to a transport connected to Juju (conn.transport) and to
information about the connected Juju server (conn.info).

#### Parameters

-   `transport` **[Object][2]** The Transport instance used to communicate with
    Juju. The transport is available exposed to users via the transport
    property of the connection instance. See the Transport docstring for
    information on how to use the transport, typically calling transport.write.
-   `facades` **[Object][2]** The facade classes provided in the facades property
    of the options provided to the connect function. When the connection is
    instantiated, the matching available facades as declared by Juju are
    instantiated and access to them is provided via the facades property of the
    connection.
-   `loginResult` **[Object][2]** The result to the Juju login request. It includes
    information about the Juju server and available facades. This info is made
    available via the info property of the connection instance.

---

[1]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[2]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[3]: https://www.npmjs.com/package/macaroon-bakery

[4]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[5]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[6]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean


## Facades Reference
- [Action Facade](action-v2.md) -
  [v2](action-v2.md)
- [ActionPruner Facade](action-pruner-v1.md) -
  [v1](action-pruner-v1.md)
- [Admin Facade](admin-v3.md) -
  [v3](admin-v3.md)
- [AllModelWatcher Facade](all-model-watcher-v2.md) -
  [v2](all-model-watcher-v2.md)
- [AllWatcher Facade](all-watcher-v1.md) -
  [v1](all-watcher-v1.md)
- [Annotations Facade](annotations-v2.md) -
  [v2](annotations-v2.md)
- [Application Facade](application-v8.md) -
  [v1](application-v1.md)
  [v2](application-v2.md)
  [v3](application-v3.md)
  [v4](application-v4.md)
  [v5](application-v5.md)
  [v6](application-v6.md)
  [v7](application-v7.md)
  [v8](application-v8.md)
- [ApplicationOffers Facade](application-offers-v2.md) -
  [v1](application-offers-v1.md)
  [v2](application-offers-v2.md)
- [Backups Facade](backups-v2.md) -
  [v1](backups-v1.md)
  [v2](backups-v2.md)
- [Block Facade](block-v2.md) -
  [v2](block-v2.md)
- [Bundle Facade](bundle-v2.md) -
  [v1](bundle-v1.md)
  [v2](bundle-v2.md)
- [CAASOperator Facade](caas-operator-v1.md) -
  [v1](caas-operator-v1.md)
- [CAASOperatorProvisioner Facade](caas-operator-provisioner-v1.md) -
  [v1](caas-operator-provisioner-v1.md)
- [CAASUnitProvisioner Facade](caas-unit-provisioner-v1.md) -
  [v1](caas-unit-provisioner-v1.md)
- [Charms Facade](charms-v2.md) -
  [v2](charms-v2.md)
- [Client Facade](client-v2.md) -
  [v1](client-v1.md)
  [v2](client-v2.md)
- [Cloud Facade](cloud-v3.md) -
  [v1](cloud-v1.md)
  [v2](cloud-v2.md)
  [v3](cloud-v3.md)
- [Controller Facade](controller-v5.md) -
  [v3](controller-v3.md)
  [v4](controller-v4.md)
  [v5](controller-v5.md)
- [CredentialManager Facade](credential-manager-v1.md) -
  [v1](credential-manager-v1.md)
- [CredentialValidator Facade](credential-validator-v2.md) -
  [v1](credential-validator-v1.md)
  [v2](credential-validator-v2.md)
- [CrossController Facade](cross-controller-v1.md) -
  [v1](cross-controller-v1.md)
- [CrossModelRelations Facade](cross-model-relations-v1.md) -
  [v1](cross-model-relations-v1.md)
- [FirewallRules Facade](firewall-rules-v1.md) -
  [v1](firewall-rules-v1.md)
- [HighAvailability Facade](high-availability-v2.md) -
  [v2](high-availability-v2.md)
- [HostKeyReporter Facade](host-key-reporter-v1.md) -
  [v1](host-key-reporter-v1.md)
- [ImageManager Facade](image-manager-v2.md) -
  [v2](image-manager-v2.md)
- [KeyManager Facade](key-manager-v1.md) -
  [v1](key-manager-v1.md)
- [LeadershipService Facade](leadership-service-v2.md) -
  [v2](leadership-service-v2.md)
- [Logger Facade](logger-v1.md) -
  [v1](logger-v1.md)
- [MachineManager Facade](machine-manager-v5.md) -
  [v2](machine-manager-v2.md)
  [v3](machine-manager-v3.md)
  [v4](machine-manager-v4.md)
  [v5](machine-manager-v5.md)
- [MeterStatus Facade](meter-status-v1.md) -
  [v1](meter-status-v1.md)
- [MetricsDebug Facade](metrics-debug-v2.md) -
  [v2](metrics-debug-v2.md)
- [ModelConfig Facade](model-config-v2.md) -
  [v1](model-config-v1.md)
  [v2](model-config-v2.md)
- [ModelManager Facade](model-manager-v5.md) -
  [v2](model-manager-v2.md)
  [v3](model-manager-v3.md)
  [v4](model-manager-v4.md)
  [v5](model-manager-v5.md)
- [NotifyWatcher Facade](notify-watcher-v1.md) -
  [v1](notify-watcher-v1.md)
- [OfferStatusWatcher Facade](offer-status-watcher-v1.md) -
  [v1](offer-status-watcher-v1.md)
- [Payloads Facade](payloads-v1.md) -
  [v1](payloads-v1.md)
- [Pinger Facade](pinger-v1.md) -
  [v1](pinger-v1.md)
- [RelationStatusWatcher Facade](relation-status-watcher-v1.md) -
  [v1](relation-status-watcher-v1.md)
- [RelationUnitsWatcher Facade](relation-units-watcher-v1.md) -
  [v1](relation-units-watcher-v1.md)
- [RemoteRelations Facade](remote-relations-v1.md) -
  [v1](remote-relations-v1.md)
- [Resources Facade](resources-v1.md) -
  [v1](resources-v1.md)
- [ResourcesHookContext Facade](resources-hook-context-v1.md) -
  [v1](resources-hook-context-v1.md)
- [RetryStrategy Facade](retry-strategy-v1.md) -
  [v1](retry-strategy-v1.md)
- [SSHClient Facade](ssh-client-v2.md) -
  [v1](ssh-client-v1.md)
  [v2](ssh-client-v2.md)
- [Singular Facade](singular-v2.md) -
  [v2](singular-v2.md)
- [Spaces Facade](spaces-v3.md) -
  [v2](spaces-v2.md)
  [v3](spaces-v3.md)
- [StatusHistory Facade](status-history-v2.md) -
  [v2](status-history-v2.md)
- [Storage Facade](storage-v4.md) -
  [v3](storage-v3.md)
  [v4](storage-v4.md)
- [Subnets Facade](subnets-v2.md) -
  [v2](subnets-v2.md)
- [UnitAssigner Facade](unit-assigner-v1.md) -
  [v1](unit-assigner-v1.md)
- [UpgradeSeries Facade](upgrade-series-v1.md) -
  [v1](upgrade-series-v1.md)
- [UserManager Facade](user-manager-v2.md) -
  [v1](user-manager-v1.md)
  [v2](user-manager-v2.md)
- [VolumeAttachmentPlansWatcher Facade](volume-attachment-plans-watcher-v1.md) -
  [v1](volume-attachment-plans-watcher-v1.md)
- [VolumeAttachmentsWatcher Facade](volume-attachments-watcher-v2.md) -
  [v2](volume-attachments-watcher-v2.md)

## Facade Helpers

Some additional helpers and method wrappers are provided in order to make the
experience of consuming the Juju API more user-friendly. Those methods can be
accessed as usual via facades and are documented above in the
[Facades Reference](#facades-reference), but
[here is an aggregated list of all of them](wrappers.md).


## Examples

Sources include some example files that can be run directly using node:
- [add machine](../../examples/add-machine.js)
- [deploy async](../../examples/deploy-async.js)
- [deploy with wrapper](../../examples/deploy-with-wrapper.js)
- [deploy](../../examples/deploy.js)
- [login with bakery using async](../../examples/login-with-bakery-using-async.js)
- [login with bakery](../../examples/login-with-bakery.js)
- [ping](../../examples/ping.js)
- [watch all models](../../examples/watch-all-models.js)
- [watch](../../examples/watch.js)