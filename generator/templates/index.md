<!---
NOTE: this file has been generated by the doc command in js-libjuju
on {{ time }}. Do not manually edit this file.
--->

# Juju API client

This project provides a JavaScript API client for interacting with the Juju
WebSocket API.

- [Getting Started](#getting-started)
- [API Reference](#api-reference)
  {%- for name in public_api %}
  - [{{ name }}](#{{ name }})
    {%- endfor %}
- [Facades Reference](#facades-reference)
- [Facade Helpers](#facade-helpers)
- [Examples](#examples)

## Getting Started

In order to access the Juju API, a connection must be made, to either a Juju
controller or model, for instance:

```javascript
const facades = [
  require("jujulib/api/facades/all-watcher-v1"),
  require("jujulib/api/facades/application-v5"),
  require("jujulib/api/facades/client-v1"),
  require("jujulib/api/facades/client-v2"),
  require("jujulib/api/facades/pinger-v1"),
];
jujulib.connect(
  "wss://example.com/model/x-y-z/api",
  { facades: facades },
  (err, juju) => {
    // Login here.
  }
);
```

In the code above, a connection is being established to the provided model API
URL, and the client declares to be interested in using the specified set of
facades. When multiple versions of the same facade are included (like the two
client versions in the example), the most recent version supported by the
server is made available to the client.

The provided callback receives an error and a _juju_ object that can be used to
log into the controller or model, by providing userpass credentials or
macaroons. When macaroons are used for logging in, a bakery instance must also
be provided as part of the options. See
<https://www.npmjs.com/package/macaroon-bakery>.

It is possible to connect and log into Juju in one single call by using
`jujulib.connectAndLogin`, for instance:

```javascript
jujulib.connectAndLogin(url, credentials, options, (err, result) => {
  // Check error here or use result.conn.
});
```

In this specific case possible redirect errors are automatically handled. The
provided callback receives a result which includes the connection itself
(from which is possible to access facade methods) and a close function used to
log out and close the connection.

All API methods and facade methods return a _Promise_ if a callback is not
provided. The above can be written in a more imperative fashion by using await:

```javascript
try {
  const {conn, close} = await jujulib.connectAndLogin(url, credentials, options);
} catch err {
  // Handle error.
}
```

Here is an example of actually using the client facade to send a request.
More examples can be found in the [examples](#examples) section.

```javascript
const options = {
  facades: [require("jujulib/api/facades/client-v1.js")],
  bakery: new bakery.Bakery({
    visitPage: (resp) => {
      console.log("visit this URL to login:", resp.Info.VisitURL);
    },
  }),
};

const { conn, close } = await jujulib.connectAndLogin(
  url,
  credentials,
  options
);
const client = conn.facades.client;
const result = await client.addMachine({ series: "bionic" });
console.log("machine added:", result.machine);
```

## API Reference

{{ api_reference }}

## Facades Reference

{%- for facade in facades %}

- [{{ facade.name }} Facade]({{ facade.versions[-1].file }}) -
  {%- for version in facade.versions %}
  [v{{ version.number }}]({{ version.file }})
  {%- endfor %}

{%- endfor %}

## Facade Helpers

Some additional helpers and method wrappers are provided in order to make the
experience of consuming the Juju API more user-friendly. Those methods can be
accessed as usual via facades and are documented above in the
[Facades Reference](#facades-reference), but
[here is an aggregated list of all of them](wrappers.md).

## Examples

Sources include some example files that can be run directly using node:
{%- for example in examples %}

- [{{ example.name }}](../../examples/{{ example.file }})

{%- endfor %}
